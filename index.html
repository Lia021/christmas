<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <script src="https://aframe.io/releases/0.7.0/aframe.min.js"></script>
 <script src="https://sdk.altvr.com/libs/altspace.js/2.7.1/altspace.min.js"></script>
 <script src="https://cdn.rawgit.com/NGenesis/altspacevr-behaviors/v0.9.2/js/altspaceutil.min.js"></script>

  <script>
    altspace.getThreeJSTrackingSkeleton().then(function (skeleton) {
          window.head = skeleton.getJoint('Head');
        });
        AFRAME.registerComponent('altspace-look-at', {
          init: function () {
            if (!window.altspace || !altspace.inClient) { return; }
          },
          tick: function () {
            if (!window.head || !this.el.object3D) { return; }
            this.el.object3D.lookAt(window.head.position); 
          }
        })
  </script>
  
  <script>
    // Generates Snow Fall Effect
    SnowFallEffect = function(config) {
        this.config = config || {};
        this.type = 'SnowFallEffect';
 
        // Helper Function To Generate Random Numbers
        this.getRandom = function(min, max) {
            return Math.random() * (max - min) + min;
        }
 
        this.awake = function(o, s) {
            this.object3d = o;
            this.scene = s;
            this.materials = [];
            this.snowflakes = [];
 
            this.snowfallVolumeSize = 5;
            this.config.particleScale = this.config.particleScale || 0.01;
            this.config.particleCount = this.config.particleCount || 100;
            this.config.particleFallSpeed = this.config.particleFallSpeed || 1;
            this.config.particleDriftSpeed = this.config.particleDriftSpeed || 1.8;
            this.config.particleRotationSpeed = this.config.particleRotationSpeed || 15;
 
            this.texture = this.config.particleTextureUrl ? new THREE.Texture({ src: altspaceutil.getAbsoluteURL(this.config.particleTextureUrl) }) : null;
            this.geometry = new THREE.PlaneGeometry(1, 1);
 
            for(var i = 0; i < 3; ++i) {
                var material = new THREE.MeshBasicMaterial({ map: this.texture, side: THREE.DoubleSide, transparent: (this.texture !== undefined), opacity: (this.texture !== undefined) ? this.getRandom(0.3 - (i * 0.05), 1.0 - (i * 0.2)) : 1 });
                material.color.r = this.getRandom(0.75, 1 - ((i + 1) * 0.025));
                this.materials.push(material);
            }
 
            if(this.config.occluders && this.config.occluders.length > 0) {
                this.snowflakeBoundingBox = new THREE.Box3();
                this.occluderBoundingBox = new THREE.Box3();
            }
        }
 
        this.update = function(deltaTime) {
            if(!this.avatarhead) {
                altspace.getThreeJSTrackingSkeleton().then((function(_skeleton) {
                    this.skeleton = _skeleton;
                    this.object3d.add(this.skeleton);
                    this.avatarhead = this.skeleton.getJoint('Head');
 
                    for(var i = 0; i < this.config.particleCount; ++i) {
                        var snowflake = new THREE.Mesh(this.geometry, this.materials[Math.floor(this.getRandom(0, this.materials.length - 1))]);
                        snowflake.userData.altspace = { collider: { enabled: false } };
 
                        // Set Up Snowflake Animation Properties
                        snowflake.userData.fallSpeed = this.config.particleFallSpeed * 0.001 * this.getRandom(0.4, 0.9);
                        snowflake.userData.driftSpeed = this.config.particleDriftSpeed * 0.001 * this.getRandom(-0.15, 0.15);
                        snowflake.userData.rotationSpeed  = this.config.particleRotationSpeed * 0.001 * this.getRandom(0.01, 0.1);
 
                        // Randomize Snowflake Position
                        snowflake.scale.setScalar(this.config.particleScale);
                        snowflake.position.set(this.avatarhead.position.x - this.scene.position.x + this.getRandom(-this.snowfallVolumeSize, this.snowfallVolumeSize), this.avatarhead.position.y - this.scene.position.y + this.getRandom(-this.snowfallVolumeSize, this.snowfallVolumeSize), this.avatarhead.position.z - this.scene.position.z + this.getRandom(-this.snowfallVolumeSize, this.snowfallVolumeSize));
 
                        this.snowflakes.push(snowflake);
                        this.object3d.add(snowflake);
                    }
                }).bind(this));
            }
 
            if(this.avatarhead) {
                for(var snowflake of this.snowflakes) {
                    var delta = { x: this.avatarhead.position.x - this.scene.position.x, y: this.avatarhead.position.y - this.scene.position.y, z: this.avatarhead.position.z - this.scene.position.z };
                    var fallThreshold = this.snowfallVolumeSize * 0.8;
                    var shiftThreshold = this.snowfallVolumeSize * 0.6;
 
                    // Shift Snow Volume To Avatar Position
                    if(snowflake.position.x < (delta.x - shiftThreshold) || snowflake.position.x > (delta.x + shiftThreshold) || snowflake.position.z < (delta.z - shiftThreshold) || snowflake.position.z > (delta.z + shiftThreshold)) {
                        snowflake.position.x = delta.x + this.getRandom(-this.snowfallVolumeSize, this.snowfallVolumeSize);
                        snowflake.position.z = delta.z + this.getRandom(-this.snowfallVolumeSize, this.snowfallVolumeSize);
                    }
 
                    if(snowflake.position.y < (delta.y - fallThreshold)) snowflake.position.y = delta.y + this.snowfallVolumeSize;
 
                    // Fall
                    snowflake.position.y -= snowflake.userData.fallSpeed * deltaTime;
 
                    // Drift
                    var cos = snowflake.userData.driftSpeed * deltaTime;
                    snowflake.position.z += cos;
                    snowflake.position.x += cos;
 
                    // Rotation
                    snowflake.rotation.y += snowflake.userData.rotationSpeed * deltaTime;
 
                    snowflake.visible = true;
 
                    if(this.config.occluders && this.config.occluders.length > 0) {
                        this.snowflakeBoundingBox.setFromObject(snowflake);
 
                        for(var occluder of this.config.occluders) {
                            this.occluderBoundingBox.setFromObject(occluder);
                            if(this.snowflakeBoundingBox.intersectsBox(this.occluderBoundingBox)) {
                                if(snowflake.parent) snowflake.parent.remove(snowflake);
                                snowflake.visible = false;
                                break;
                            }
                        }
                    }
 
                    if(snowflake.visible && !snowflake.parent) this.object3d.add(snowflake);
                }
            }
        }
 
        this.dispose = function() {
            if(this.object3d) {
                for(var snowflake of this.snowflakes) this.object3d.remove(snowflake);
                if(this.skeleton) this.object3d.remove(this.skeleton);
            }
        }
    }
 
    if(window.AFRAME) {
        if(AFRAME.components['snowfall-effect']) delete AFRAME.components['snowfall-effect'];
 
        AFRAME.registerComponent('snowfall-effect', {
            init: function() {
                var isMobileDevice = /mobile/i.test(navigator.userAgent);
                this.behavior = new SnowFallEffect({ particleScale: isMobileDevice ? 0.005 : 0.01, particleCount: isMobileDevice ? 90 : 500, particleTextureUrl: isMobileDevice ? null : 'snowflake.png' })
                this.el.object3D.addBehavior(this.behavior);
            },
            remove: function() {
                if(this.behavior) this.el.object3D.removeBehavior(this.behavior);
            }
        });
    }
</script>

  <body>
      <a-scene altspace=fullspace:true sync-system="author: bookgirl; app: christmas" snowfall-effect>
    <a-assets>
      <a-asset-item id="tree" src="https://rawgit.com/Lia021/christmas/master/christmas-tree/Christmas-tree.dae"></a-asset-item>
      <a-asset-item id="star" src="https://rawgit.com/Lia021/christmas/master/star/star.dae"></a-asset-item>
      <a-asset-item id="ben-shoo" src="https://rawgit.com/Lia021/christmas/master/present/ben-shoo.dae"></a-asset-item>
      <a-asset-item id="evil" src="https://rawgit.com/Lia021/christmas/master/present/evil.dae"></a-asset-item>
      <a-asset-item id="katherine" src="https://rawgit.com/Lia021/christmas/master/present/katherine.dae"></a-asset-item>
      <a-asset-item id="genesis" src="https://rawgit.com/Lia021/christmas/master/present/genesis.dae"></a-asset-item>
      <a-asset-item id="riche" src="https://rawgit.com/Lia021/christmas/master/present/riche.dae"></a-asset-item>
      <a-asset-item id="beng" src="https://rawgit.com/Lia021/christmas/master/present/beng.dae"></a-asset-item>
      <a-asset-item id="zarzar" src="https://rawgit.com/Lia021/christmas/master/present/zar-zar.dae"></a-asset-item>
      <a-asset-item id="rage" src="https://rawgit.com/Lia021/christmas/master/present/rage.dae"></a-asset-item>
      <a-asset-item id="snow" src="https://rawgit.com/Lia021/christmas/master/snow/snow2.dae"></a-asset-item>
      



    </a-assets>

    <!--snow-->
 
   <a-entity position="-2.37 2.80 -5.84"  n-mesh-collider="type: environment; convex: false" collada-model="#snow"></a-entity>  
   

   <!--christmas tree-->
 
   <a-entity position="-2.65 0.40 -6" scale="1.50 1.50 1.50" n-mesh-collider="type: environment; convex: false" collada-model="#tree"></a-entity>  
  
    <!--christmas tree2-->
 
    <a-entity position="0 0.05 9" scale="1.50 1.50 1.50" collada-model="#tree"></a-entity>
         

    <!--star-->
 
    <a-entity position="0 6.20 9" scale="1.50 1.50 1.50" n-mesh-collider="type: environment; convex: false" collada-model="#star"><a-animation attribute="rotation" dur="35000" fill="forwards" to="0 360 0" repeat="indefinite" easing="linear"></a-animation></a-entity>
     
    <!--star2-->
 
    <a-entity position="-2.66 6.58 -6" scale="1.50 1.50 1.50" n-mesh-collider="type: environment; convex: false" collada-model="#star"><a-animation attribute="rotation" dur="35000" fill="forwards" to="0 360 0" repeat="indefinite" easing="linear"></a-animation></a-entity>
        
   <!--ben-shoo-->
 
   <a-entity position="-2.30  0.45  -4.55" scale="1 1 1" n-mesh-collider="type: environment; convex: false" collada-model="#ben-shoo"></a-entity>
   
   <!--evil-->
 
   <a-entity position="-1.90 0.40  -4.87" scale="1.90 1.90 1.90" n-mesh-collider="type: environment; convex: false" collada-model="#evil"></a-entity>
      
   <!--katherine-->
 
   <a-entity position="-1.50 0.40  -5.20" scale="1.10 1.10 1.10" n-mesh-collider="type: environment; convex: false" collada-model="#katherine"></a-entity>
   
   <!--genesis-->
 
   <a-entity position="-1.20 0.40  -5.57" scale="1.70 1.70 1.70" n-mesh-collider="type: environment; convex: false" collada-model="#genesis"></a-entity>
    
   <!--riche-->
 
   <a-entity position="-1.20 0.40  -5.97" scale="0.95 0.95 0.95" n-mesh-collider="type: environment; convex: false" collada-model="#riche"></a-entity>
   
   <!--beng-->
 
   <a-entity position="-1.20 0.55  -6.36" scale="1.60 1.60 1.60" n-mesh-collider="type: environment; convex: false" collada-model="#beng"></a-entity>


   <!--zarzar-->
 
   <a-entity position="-1.54 0.40  -6.76" scale="1.40 1.40 1.40" n-mesh-collider="type: environment; convex: false" collada-model="#zarzar"></a-entity>

   <!--rage-->
 
  <a-entity position="-1.85 0.55  -7.13" scale="1.05 1.05 1.05" n-mesh-collider="type: environment; convex: false" collada-model="#rage"></a-entity>

    

    <!--Christmas Lights-->
    <a-sphere position="20 5.0 0" src="https://rawgit.com/Lia021/christmas/master/light/red.jpg" radius="0.99" segments-width="10" segments-height="6"></a-sphere>
    <a-sphere position="18.0 4.9 5" src="https://rawgit.com/Lia021/christmas/master/light/blue.jpg" radius="0.89" segments-width="10" segments-height="6"></a-sphere>
    <a-sphere position="18.0 4.8 -5" src="https://rawgit.com/Lia021/christmas/master/light/purple.jpg" radius="0.89" segments-width="10" segments-height="6"></a-sphere>
    <a-sphere position="21.50 4.8 -10" src="https://rawgit.com/Lia021/christmas/master/light/yellow.jpg" radius="0.89" segments-width="10" segments-height="6"></a-sphere>
    <!--Snowman Body-->
    <a-sphere position="3 0.60 0" color="white" radius="0.48" segments-height="5" segments-width="10"></a-sphere>
    <a-sphere position="3 1.27 0" color="white" radius="0.40" segments-height="5" segments-width="10"></a-sphere>
    <a-cone position="3 2.37 -0" color="red" segments-height="1" segments-radial="10" radius-bottom="0.2" height="1" radius-top="0" attribute="rotation" dur="10000.5" fill="forwards" to="0 360 0" repeat="indefinite" easing="linear">
    </a-cone>
    <!--Christmas Gifts-->
    <a-box position="-9 1 0" src="https://rawgit.com/Lia021/christmas/master/gift/damask-pattern-seamless-background.jpg" height="2" width="1" side="double"></a-box>
    <a-box position="18  0.50 -22.90" src="https://rawgit.com/Lia021/christmas/master/gift/star.jpg" height="2" width="1" side="double"></a-box>
    <a-box position="12  0.55 20" src="https://rawgit.com/Lia021/christmas/master/gift/depositphotos_4544366-stock-illustration-seamless-deep-red-christmas-texture.jpg" height="2" width="1" side="double"></a-box>
    <a-box position="-11  0.50 -9" src="https://rawgit.com/Lia021/christmas/master/gift/499001990.jpg" height="2" width="1" side="double"></a-box>
    <!--Christmas Presents-->
    <a-box position="1.80 0.30  8.70" color="white" depth="0.3" height="0.3" width="0.3"></a-box>
    <a-box position="1.40 0.30 8.10" color="red" depth="0.3" height="0.3" width="0.3"></a-box>
    <a-box position="1 0.30 7.80" color="blue" depth="0.3" height="0.3" width="0.3"></a-box>
    <a-box position="0.60 0.30 7.30" color="yellow" depth="0.3" height="0.3" width="0.3"></a-box>
    <a-box position="0.20 0.30 7.20" color="green" depth="0.3" height="0.3" width="0.3"></a-box>
    <a-box position="-0.20 0.30 7.25" color="gray" depth="0.3" height="0.3" width="0.3"></a-box>
    <a-box position="-0.55 0.30 7.40" color="#070e40" depth="0.3" height="0.3" width="0.3"></a-box>
    <a-box position="-0.95 0.30 7.86" color="orange" depth="0.3" height="0.3" width="0.3"></a-box>
    <a-box position="-1.35 0.30 8.40" color="black" depth="0.3" height="0.3" width="0.3"></a-box>
    <!--Christmas Sign-->
    <a-image position="-6 6 0" src="https://rawgit.com/Lia021/christmas/master/Merry-Christmas-Text-1.png" height="2" width="4" side="double" rotation="20 -90 0"></a-image>
    <!--Mystery Boxes-->
    <a-box position="18 0.75 -23" src="images/2rJJo1L.jpg" depth="0.3" height="0.3" width="0.3"></a-box>
    <a-box position="12 0.75 20" src="images/XV6zhrh.jpg" depth="0.2" height="0.2" width="0.2"></a-box>
    <a-box position="-11 0.77 -9" src="images/u3oCsGP.jpg" depth="0.2" height="0.2" width="0.2"></a-box>
    <a-box position="-9 0.75 -0.20" src="images/HjueoEI.jpg" depth="0.3" height="0.3" width="0.3"></a-box>
    <a-box position="0 1.50 9" src="images/Hukt24D.jpg" depth="0.3" height="0.3" width="0.3"></a-box>
    <a-box position="9.30 0.75 -9" src="images/B2rWkfS.jpg" depth="0.3" height="0.3" width="0.3" rotation="0 -90 0"></a-box>
    <a-box position="-14 0.75 7.60" src="images/0jKK5mo.jpg" depth="0.3" height="0.3" width="0.3"></a-box>
   <!--Mystery Boxes 2-->
    <a-box position="-0.15 0.69 -3" src="images/0ZPW8gf.jpg" depth="0.4" height="0.4" width="0.4" rotation="0 -90 0"></a-box>
    <a-box position="10 7.51 -8" src="images/J0NcVPr.jpg.jpg" depth="0.4" height="0.4" width="0.4" rotation="0 90 0"></a-box>
    <a-box position="-5.80 0.6 1.96" src="images/MRUe8eT.jpg" depth="0.3" height="0.3" width="0.3" rotation="0 -90 0"></a-box>
    <a-box position="8.70 0.3 5" src="images/e2h8mIk.jpg" depth="0.3" height="0.3 " width="0.3" rotation="0 -90 0"></a-box>
    <a-box position="3.60 -0.3 -15" src="images/7RwnJaX.jpg" depth="0.3" height="0.3" width="0.3" rotation="0 -90 0"></a-box>
    <a-box position="9.50 -0.3 -15" src="images/556kMz7.jpg" depth="0.3" height="0.3" width="0.3" rotation="0 -90 0"></a-box>
    <a-box position="-0.63 -0.3 -15" src="images/TdbtVS3.jpg" depth="0.3" height="0.3" width="0.3" rotation="0 -90 0"></a-box>
    <a-box position="-18 -1.15 -14" src="images/GuLSwSf.jpg" depth="0.3" height="0.3" width="0.3" rotation="0 -90 0"></a-box>
    <a-box position="7 -1.30 13" src="images/pJjtJeT.jpg" depth="0.3" height="0.3" width="0.3" rotation="0 -90 0"></a-box>
    <a-box position="4.50 -0.30 11.85" src="images/KdR07li.jpg" depth="0.3" height="0.3" width="0.3" rotation="0 -90 0"></a-box>
    <a-box position="33 -9.70 -29" src="images/Og6KDgZ.jpg" depth="0.3" height="0.3" width="0.3" rotation="0 90 0"></a-box>
    <a-box position="-17.50 -2 22" src="images/t9o83Gx.jpg" depth="0.3" height="0.3" width="0.3" rotation="0 90 0"></a-box>
    <a-box position="-15 17 -18" src="images/cjfskyF.jpg" depth="0.3" height="0.3" width="0.3" rotation="0 90 0"></a-box>
    <a-box position="-22 16 18" src="images/3r5hHZA.jpg" depth="0.3" height="0.3" width="0.3" rotation="0 90 0"></a-box>
    <a-box position="21 23 -25" src="images/IBJ8xcY.jpg" depth="0.3" height="0.3" width="0.3" rotation="0 90 0"></a-box>
 
    <!--Christmas Presents 2-->
   <a-box position="-2.25 0.7  -7.39" color="red" depth="0.3" height="0.3" width="0.3"></a-box>
   
   

  
  </a-scene>
</body>

</html>



